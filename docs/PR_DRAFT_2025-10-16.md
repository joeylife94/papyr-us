# PR Draft — 2025-10-16

제목: chore(docs): sync RBAC/admin docs with middleware and remove E2E debug logging

요약:

- `server/routes.ts`에서 E2E triage 중 생성된 임시 POST 디버그 로깅(`test-server-received-posts.log`)을 제거했습니다.
- `docs/rbac-guide.md`와 `docs/admin-panel-guide.md`를 `server/middleware.ts` 및 `server/routes.ts`와 일치하도록 업데이트했습니다 (JWT 우선, 비밀번호 폴백 문서화 등).
- `docs/backend-test-cases.md`에 테스트 매핑(테스트 케이스 ID ↔ 구현된 테스트 파일)을 추가했습니다.

변경 파일:

- server/routes.ts (chore: remove ephemeral e2e logging)
- docs/rbac-guide.md (docs: clarify requireAdmin behavior and env vars)
- docs/admin-panel-guide.md (docs: add curl examples and troubleshooting)
- docs/backend-test-cases.md (docs: test matrix)
- docs/pre-work/changelog.md (docs: add 2.3.1 changelog entry)

배포 영향:

- 문서와 내부 도구 사용성 향상. 운영 환경에서는 `allowAdminPassword`(또는 동등 설정)를 `false`로 전환하는 것을 권장합니다.

후속 권장 작업:

1. 운영 환경에서 비밀번호 기반 관리자 접근을 비활성화하고 내부 스크립트가 이를 사용하지 않는지 확인하세요.
2. 관리자 엔드포인트에 대한 보안 회귀 테스트를 CI에 추가하세요.
3. 관리자 UI 스크린샷을 최신 흐름으로 교체하세요.

---

주의: 요청자께서 PR 없이 바로 `main`에 커밋/푸시하겠다고 하셨으므로, 이 초안은 기록용으로만 보관됩니다.

## 테스트 계획

1. 로컬(또는 CI)에 `.env.test`를 준비하고, 테스트 DB가 실행 중인지 확인합니다.
2. 다음 명령으로 Authentication + Wiki E2E 그룹을 재실행하여 인증/리다이렉트 문제 해결 여부를 확인합니다:

```powershell
npx playwright test tests/example.spec.ts --project=chromium --grep "Authentication|Wiki" --trace on
```

3. 문제가 재현되면, `E2E_DEBUG_AUTH=1` 환경 변수를 켜고 재실행하여 서버 로그에서 `/api/auth/*` 호출의 흐름을 확인합니다:

```powershell
$env:E2E_DEBUG_AUTH='1'; npx playwright test tests/example.spec.ts --project=chromium --grep "Authentication|Wiki" --trace on
```

4. 문제가 해결되면 전체 E2E 스위트를 실행하여 회귀가 없는지 확인합니다.

## 추천 리뷰어

- @backend-team (심층 인증/토큰 흐름 점검)
- @qa (E2E 재실행 및 CI 파이프라인 검증)
