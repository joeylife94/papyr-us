# 관리자 패널 가이드

## 관리자 패널 접근

### 접근 방법 (권장 순서)

1. 헤더 우측의 톱니바퀴(Settings) 아이콘 클릭
2. 권장: 관리자 계정으로 로그인하여 JWT 기반 인증을 사용합니다. (관리자 계정은 `ADMIN_EMAILS`에 등록되어 있어야 합니다)
3. 임시/하위 호환: 단기 관리자 비밀번호를 사용하는 흐름이 존재하지만, 운영 환경에서는 사용을 지양하세요.

### 보안 기능

- JWT(권장) 및 단기 관리자 비밀번호(하위 호환)
- 세션 기반 인증 유지(클라이언트에서 로컬 스토리지/세션 저장 방식에 따라 동작함)
- 무단 접근 방지(관리자 라우트는 서버에서 `requireAdmin`으로 보호됨)

## 디렉토리 생성

1. "새 디렉토리 생성" 버튼 클릭
2. 필수 정보 입력:
   - **디렉토리 이름**: 시스템에서 사용할 고유 이름 (영문, 숫자, 하이픈만 허용)
   - **표시 이름**: 사용자에게 보여질 이름 (한글 포함 가능)
   - **비밀번호(선택)**: 해당 디렉토리 접근용 비밀번호 (선택사항, 저장 시 해시화되어야 함)
   - **순서**: 사이드바에서의 표시 순서
   - **비밀번호**: 해당 디렉토리 접근용 비밀번호 (선택사항)
   - **순서**: 사이드바에서의 표시 순서

### 디렉토리 수정

1. 디렉토리 목록에서 "수정" 버튼 클릭
2. 원하는 정보 변경
3. "저장" 버튼으로 변경사항 적용

### 디렉토리 삭제

1. 디렉토리 목록에서 "삭제" 버튼 클릭
2. 확인 대화상자에서 삭제 확인
3. **주의**: 디렉토리 삭제 시 해당 디렉토리는 '휴지통'으로 이동하며, 내부 페이지들은 즉시 접근 불가능하게 됩니다. 영구 삭제는 휴지통에서 별도로 수행해야 합니다.

### 디렉토리 복원

1. 관리자 패널의 '휴지통' 메뉴로 이동
2. 복원할 디렉토리 선택 후 "복원" 버튼 클릭
3. 디렉토리와 내부 페이지들이 즉시 복구됩니다.

## 기본 디렉토리 구조

### 시스템 기본 디렉토리

1. **docs** (Documentation) - 프로젝트 문서
2. **ideas** (Ideas) - 아이디어 및 기획
3. **members** (Members) - 팀원 정보
4. **logs** (Logs) - 활동 로그
5. **archive** (Archive) - 보관 문서
6. **team1** (Team Alpha) - 알파 팀 작업공간
7. **team2** (Team Beta) - 베타 팀 작업공간

### 팀 디렉토리 특별 기능

- **팀 캘린더**: 팀별 전용 캘린더 시스템
- **페이지 생성**: 팀 전용 페이지 빠른 생성
- **협업 도구**: 팀원 간 문서 공유

## 디렉토리 접근 권한

### 공개 디렉토리

- 비밀번호가 설정되지 않은 디렉토리
- 모든 사용자가 자유롭게 접근 가능
- 기본적으로 대부분의 디렉토리가 공개

### 보호된 디렉토리

- 비밀번호가 설정된 디렉토리
- 올바른 비밀번호 입력 시에만 접근 가능
- 민감한 정보나 특정 팀 전용 자료에 적합

## 관리자 권한

### 전체 시스템 관리

- 모든 디렉토리 생성/수정/삭제
- 시스템 설정 변경
- 사용자 접근 권한 관리

### 데이터 관리

- 페이지 일괄 관리
- 백업 및 복원
- 시스템 통계 확인

## 보안 및 운영 팁

- 디렉토리 비밀번호는 서버에서 반드시 해시(예: bcryptjs)로 저장되어야 합니다. `storage.verifyDirectoryPassword`는 이를 검증합니다.
- 관리자 패널의 민감한 작업(디렉토리 삭제, 권한 변경 등)은 가능한 경우 다단계 확인(확인 대화상자 + 관리자 토큰 재확인)을 요구하세요.

## 모범 사례

### 디렉토리 명명 규칙

- **시스템 이름**: 영문 소문자, 숫자, 하이픈만 사용
- **표시 이름**: 직관적이고 명확한 한글/영문 이름
- **일관된 구조**: 비슷한 성격의 디렉토리는 유사한 패턴 사용

### 보안 관리

- 강력한 비밀번호 사용 (8자 이상, 특수문자 포함)
- 정기적인 비밀번호 변경
- 불필요한 접근 권한 최소화

### 디렉토리 구조 설계

- 논리적이고 직관적인 구조
- 적절한 깊이와 폭 유지
- 사용자 접근 패턴 고려

## 문제 해결

### 일반적인 문제

1. **비밀번호 분실**: 관리자가 재설정 필요
2. **디렉토리 접근 불가**: 권한 설정 확인
3. **삭제된 디렉토리 복구**: 백업에서 복원 필요

### 응급 상황 대처

- 관리자 패널 접근 불가 시 개발자 문의
- 중요 데이터 손실 시 즉시 백업 복원
- 시스템 오류 발생 시 로그 확인 및 재시작

## 클라이언트 사용 예시 (관리자 API)

1. JWT 기반(권장)

```bash
curl -H "Authorization: Bearer <관리자_JWT>" https://your-app.example.com/api/admin/directories
```

2. 비밀번호로 단기 관리자 토큰 발급 (서버: `/api/admin/auth`)

```bash
curl -X POST -H "Content-Type: application/json" -d '{"password":"<ADMIN_PASSWORD>"}' https://your-app.example.com/api/admin/auth
# 응답으로 { "success": true, "token": "<TOKEN>" } 형태의 단기 토큰이 반환됩니다.
```

발급된 토큰 사용 예:

```bash
curl -H "Authorization: Bearer <TOKEN>" https://your-app.example.com/api/admin/directories
```

3. 하위 호환: 헤더/쿼리 기반 (권장하지 않음)

```bash
curl -H "x-admin-password: <ADMIN_PASSWORD>" https://your-app.example.com/api/admin/directories
curl https://your-app.example.com/api/admin/directories?adminPassword=<ADMIN_PASSWORD>
```

## 문제 해결(트러블슈팅)

관리자 접근이 거부될 때 확인할 체크리스트:

- 요청 헤더의 `Authorization` 형식이 `Bearer <토큰>`인지 확인하세요.
- JWT를 사용한다면 토큰 페이로드에 `role: 'admin'` 또는 `email`이 `ADMIN_EMAILS`에 포함되어 있는지 확인하세요. (디코드: `jwt.decode`로 확인 가능)
- 비밀번호 기반 접근을 사용 중이라면 서버 구성에서 `allowAdminPassword`(또는 `ALLOW_ADMIN_PASSWORD`)가 `true`로 설정되어 있는지와 `adminPassword` 값이 일치하는지 확인하세요.
- 서버 로그에서 `Denied admin access` 메시지가 있는지 확인하고, 타임스탬프와 IP를 함께 확인하세요.
- `requireAdmin` 미들웨어는 토큰 해독을 먼저 시도한 뒤(성공 시 req.user 설정), role/email 확인, 이후 비밀번호 폴백을 적용합니다. 이 순서를 이해하면 문제 원인 파악에 도움이 됩니다.
- 로컬에서 재현 시, Playwright나 다른 테스트 도구가 서버를 재시작하며 동작하는지 여부도 체크하세요(웹서버 재사용 설정 때문에 포트 충돌이 발생할 수 있습니다).

## 스크린샷 / 캡션 교체 권장

현재 문서 내부에 인라인 스크린샷 참조가 적은 상태입니다. 다만 관리자 UI에 "관리자 비밀번호 입력"만을 강조하는 기존 스크린샷이 있다면 아래 작업을 권장합니다:

- 스크린샷 캡션을 "JWT 기반 관리자 로그인 권장 — 비밀번호 기반은 하위 호환용"으로 변경하세요.
- 스크린샷이 오래된 UI를 보여주면, 최신 관리자 로그인 흐름(우측 상단 Settings 아이콘 → 로그인 또는 관리자 계정으로 로그인)으로 재촬영하여 교체하세요.
- 교체 대상 이미지 파일을 찾으려면 레포지토리 내 `docs/` 폴더와 `docs/assets/` (또는 유사 폴더)를 검색해 주세요. 지금은 문서에 직접 삽입된 이미지가 발견되지 않아, 별도 이미지 목록을 생성했습니다.

### 자리표시자(문서 삽입 예시)

아래는 문서에 스크린샷을 삽입할 때 사용할 자리표시자 예시입니다. 실제 이미지를 `docs/assets/`에 업로드한 뒤 파일명을 대체하세요.

```markdown
![관리자 로그인](./assets/admin-login-20251016.png)
_관리자 로그인 (JWT 기반 권장)_

![디렉토리 생성](./assets/admin-login-20251016.png)
_디렉토리 생성: 디렉토리 이름, 표시 이름, 비밀번호(선택)_
```

스크린샷 업로드 후 제가 문서 파일들을 자동으로 교체해 커밋해 드릴 수 있습니다. 업로드하시면 파일명을 알려 주세요.

## 향후 개선 계획

1. RBAC(현재 문서화됨) 완전 도입 및 역할별 권한 세분화
2. 디렉토리별 세부 권한 설정(읽기/쓰기/관리)
3. 감사 로그 및 활동 추적(immutable logs)
4. 자동 백업 및 주기적 복원 검증
5. 사용자 그룹 관리 및 권한 전파 정책

## History

### 2025-09-22 — 운영/관리 관련 업데이트

- CI와 린트 체인의 정비로 관리자 패널 관련 코드 변경 시 PR에서 자동으로 스타일 검사가 수행됩니다.
- 관리자 패널에서 디렉토리/권한 관련 작업을 문서화하고, 향후 RBAC(역할 기반 접근 제어) 도입 계획을 명시했습니다.

## Next steps

- 관리자 패널에 대한 권한 감사 로그(감사 추적) 및 RBAC 설계 문서를 준비하세요.
- 민감 정보(예: 디렉토리 비밀번호) 처리 방식에 대한 보안 검토 및 암호화/해싱 정책을 수립하세요.

---

참고: 관리자 패널 동작은 `server/routes.ts`의 `/api/admin/*` 엔드포인트 및 `requireAdmin` 미들웨어에 의해 보호됩니다. 문서를 갱신할 때 해당 코드를 참조하세요.
