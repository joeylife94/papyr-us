# 개발 진행 상황 및 현재 이슈

## 📅 최종 업데이트: 2025-08-13 (서버 구조 리팩토링 및 안정화 시도)

---

## ✅ 작업 기록

### 2025-08-13
- **서버 구조 리팩토링 및 안정화 시도** 🛠️
  - **원인 분석**: E2E 테스트가 간헐적으로 성공하고 대부분 실패하는 현상의 근본 원인을 서버의 구조적 불안정성으로 판단했습니다. 특히 서버의 진입점(`index.ts`, `production.ts`)과 데이터베이스 관리(`storage.ts`) 코드가 복잡하게 얽혀있어, 테스트 환경에서 예기치 않은 서버 충돌을 유발하는 것으로 추정했습니다.
  - **서버 구조 리팩토링**:
    - **`storage.ts` 단순화**: `DBStorage` 클래스만 남기고 불필요한 인터페이스를 제거했습니다.
    - **서버 진입점 통합**: `index.ts`와 `production.ts`의 로직을 `index.ts` 하나로 통합하여, 환경 변수(`NODE_ENV`)에 따라 개발/프로덕션 모드를 모두 처리하도록 변경했습니다.
    - **단일 `storage` 인스턴스 보장**: 서버의 메인 진입점에서 `DBStorage` 인스턴스를 단 한 번만 생성하고, 이를 모든 API 라우트와 서비스(`socket.ts` 등)에 의존성 주입 방식으로 전달하도록 구조를 명확히 했습니다.
  - **빌드 스크립트 수정**: 서버 진입점 통합에 따라 `package.json`의 `build` 스크립트와 `docker-compose.yml`의 실행 명령을 `server/index.ts`를 바라보도록 수정했습니다.

### 2025-08-12
- **E2E 테스트 환경 및 코드베이스 안정화** 🚀
  - **원인 분석**: E2E 테스트 실패의 근본 원인이 코드베이스 전반에 하드코딩된 `/papyr-us` 경로와 `playwright.config.ts`의 `baseURL` 설정 충돌임을 파악했습니다.
  - **경로 수정**: 클라이언트, 서버, 테스트, 문서 등 프로젝트의 모든 파일에서 `/papyr-us` 접두사를 제거하여 경로를 표준화했습니다.
  - **Docker 빌드 오류 해결**: 경로 수정 후 발생한 `default` export 누락 문제를 해결하여 Docker 이미지가 성공적으로 빌드되도록 수정했습니다.
  - **서버 실행 오류 해결**: Docker 컨테이너 로그 분석을 통해 `storage` 객체의 중복 및 잘못된 초기화 문제를 발견하고, `storage.ts`에서 단일 인스턴스를 생성하여 공유하도록 의존성 구조를 개선했습니다.
  - **테스트 스크립트 개선**: Docker 대상 테스트(`e2e`)와 로컬 디버깅용 테스트(`e2e:local`, 로그 파일 생성 포함) 스크립트를 분리하고, 관련 내용을 `development-guide.md`에 문서화하여 개발 편의성을 높였습니다.

## 🧪 테스트 진행 상황 (2025-08-13)

- [x] **백엔드 API 통합 테스트 완료 및 안정화**
- [x] **E2E 테스트 환경 및 코드베이스 안정화**
- [ ] **(진행 중)** 서버 구조 리팩토링을 통한 근본적인 안정성 확보
- [ ] **(진행 예정)** E2E 테스트 전체 통과 확인

## 🚨 현재 발생하는 주요 이슈

- **이슈**: **서버 구조 리팩토링 후에도 E2E 테스트 전체 실패**
- **상황**: 서버의 구조를 단순화하고 데이터베이스 연결을 안정화하는 대규모 리팩토링을 진행했음에도 불구하고, E2E 테스트는 여전히 모두 실패하고 있습니다. '회원가입' 테스트의 성공률이 오히려 더 떨어지는 등 상황이 개선되지 않았습니다.
- **추정**: 현재로서는 문제의 원인이 명확하지 않습니다. 코드베이스에 아직 발견되지 않은 또 다른 종류의 버그가 존재하거나, 테스트 환경 자체의 문제일 가능성도 배제할 수 없습니다.

---

## 📝 우선적으로 해야 할 일 (TO-DO)

1.  **새로운 관점에서 원인 분석 (최우선)**
    - **서버 로그 재분석**: 내일 아침, 마지막으로 실행된 테스트의 서버 로그(`docker logs papyr-us-app-1`)를 다시 정밀하게 분석하여, 리팩토링 이후 새로운 에러 패턴이 나타나는지 확인합니다.
    - **클라이언트 코드 분석**: 서버가 아닌 클라이언트 측(React) 코드에 문제가 있을 가능성을 열어두고, `App.tsx`의 렌더링 로직, `useAuth` 훅의 인증 처리 흐름 등을 집중적으로 검토합니다.
    - **단계적 디버깅**: 가장 간단한 테스트 케이스('성공적인 회원가입') 하나만 남기고 나머지를 모두 비활성화한 뒤, 해당 테스트가 성공하는지 확인하여 문제의 범위를 좁혀나가는 전략을 시도합니다.
2.  **남은 E2E 테스트 오류 수정**: 새로운 원인을 파악하고 해결하여 모든 테스트가 통과할 때까지 디버깅을 반복합니다.
3.  **UI/UX 개선**: 모든 테스트가 안정화되면, 기존에 계획했던 모바일 최적화, 다크모드 개선, 접근성 향상 작업을 재개합니다.